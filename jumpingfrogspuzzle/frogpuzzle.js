(function(){function l(a,b){var c={};c.type=a;c.cell=b;return c}function m(a){a=11<a?[-.5,a+.5]:[a/2-6,a/2+6];return d3.scale.linear().domain(a).range([0,1E3])}function n(a){a=11<a?[.4-a/10,a/10+.6]:[-.7,1.7];return d3.scale.linear().domain(a).range([0,200])}function p(a){0<c+a&&(c+=a,k=2*c+1,d=m(k),e=n(k),d3.select("#numcounters").text(c+""),q(k),f.reset(c),g=0,h())}function q(a){d3.select("#grid rect").attr("x",d(0)).attr("y",e(0)).attr("width",d(a)-d(0)).attr("height",e(1)-e(0));a=r.selectAll("#grid .vert").data(d3.range(a+
1));a.enter().append("line");a.attr("class","vert").attr("y1",e(0)).attr("y2",e(1)).attr("x1",function(a){return d(a)}).attr("x2",function(a){return d(a)});a.exit().remove()}function h(){d3.select("defs").selectAll("g").attr("transform","scale("+(d(1)-d(0))/100+")");var a=d3.select("#counterdropdown").node().value,b=d3.select("#counters").selectAll("#counters use").data(f.list);b.enter().append("use");b.attr("xlink:href",function(b){return a+b.type}).attr("y",e(0)).on("click",function(a){var b=f.findhop(a);
-1!=b&&(a.cell=b,g++,h())}).transition().attr("x",function(a){return d(a.cell)});b.exit().remove();f.movesleft()?d3.select("#movesleft").text("YES"):d3.select("#movesleft").text("NO");d3.select("#count").text(g);d3.select("#message").html(t[g==c*(c+2)?2:f.movesleft()?0:1])}var c=3,k=2*c+1,g=0,t=["&nbsp;","Uh oh. Seems like you're stuck. Click reset to try again.","You did it! Well done!"],f={list:[],reset:function(a){this.list=[];for(var b=0;b<a;b++)this.list.push(l("A",b));for(b=a+1;b<2*a+1;b++)this.list.push(l("B",
b))},isempty:function(a){return 0>a||a>this.list.length?!1:!this.list.some(function(b){return b.cell==a})},empty:function(){for(var a=0;a<=this.list.length;){if(isempty(a))return a;a++}},findhop:function(a){var b=0;"A"==a.type?b=1:"B"==a.type&&(b=-1);return this.isempty(a.cell+b)?a.cell+b:this.isempty(a.cell+2*b)?a.cell+2*b:-1},movesleft:function(){var a=this;return this.list.some(function(b){return-1!=a.findhop(b)})}};f.reset(c);var r=d3.select("#grid"),d=m(7),e=n(7);d3.select("#grid").append("rect");
d3.select("#reset").on("click",function(){f.reset(c);g=0;h()});q(7);h();d3.select("#counterdropdown").on("change",function(){h()});d3.select("#up").on("click",function(){p(1)});d3.select("#down").on("click",function(){p(-1)})})();
